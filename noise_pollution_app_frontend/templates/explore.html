<!-- templates/explore.html -->
{% extends "base.html" %}
{% block title %}Explore · Noise Explorer{% endblock %}

{% block content %}
<header class="container py-4 py-lg-5">
  <div class="d-flex flex-wrap justify-content-between align-items-end gap-3">
    <div>
      <div class="d-flex flex-wrap gap-2 mb-2">
        <span class="pill pill-dark"><i class="bi bi-geo-alt me-1"></i>Zone-level only</span>
        <span class="pill pill-soft"><i class="bi bi-database me-1"></i>Synthetic & anonymised</span>
      </div>
      <h1 class="h2 fw-bold mb-1">Explore Noise Trends</h1>
      <p class="muted mb-0">Use filters to view zone-level noise trends and summary metrics.</p>
    </div>

    <div class="d-flex gap-2">
      <button class="btn btn-outline-secondary btn-pill" id="exportCsvBtn" type="button">Export CSV</button>
      <button class="btn btn-outline-secondary btn-pill" id="exportPdfBtn" type="button">Export PDF</button>
    </div>
  </div>
</header>

<main class="container pb-5">
  <!-- Filters -->
  <div class="card app-card mb-3">
    <div class="card-body">
      <form id="exploreFilters" class="row g-3 align-items-end" method="get" action="{{ url_for('explore') }}">
        <div class="col-md-4">
          <label class="form-label fw-semibold" for="zone">Zone</label>
          <select class="form-select" id="zone" name="zone">
            <option value="">Select a zone...</option>
          </select>
        </div>

        <div class="col-md-4">
          <label class="form-label fw-semibold" for="time_window">Time window</label>
          <select class="form-select" id="time_window" name="time_window">
            <option>Last 24 hours</option>
            <option selected>Last 7 days</option>
            <option>Last 4 weeks</option>
          </select>
        </div>

        <div class="col-md-3">
          <label class="form-label fw-semibold" for="source">Source</label>
          <select class="form-select" id="source" name="source">
            <option selected>Both</option>
            <option>Sensor</option>
            <option>Reports</option>
          </select>
        </div>

        <div class="col-md-3">
          <label class="form-label fw-semibold" for="category">Category</label>
          <select class="form-select" id="category" name="category">
            <option value="">All categories</option>
            <option value="traffic">Traffic</option>
            <option value="music">Music</option>
            <option value="construction">Construction</option>
            <option value="machinery">Machinery</option>
            <option value="event">Event</option>
            <option value="voices">Voices</option>
            <option value="sports">Sports</option>
            <option value="other">Other</option>
          </select>
        </div>

        <div class="col-md-2">
          <label class="form-label fw-semibold" for="trend_granularity">Trend mode</label>
          <select class="form-select" id="trend_granularity" name="trend_granularity">
            <option value="hour" selected>Hour</option>
            <option value="day">Day</option>
            <option value="week">Week</option>
          </select>
        </div>

        <div class="col-md-1 d-grid">
          <button class="btn btn-dark btn-pill" type="submit">
            <i class="bi bi-funnel me-1"></i>Apply
          </button>
        </div>
      </form>

      <div class="small text-muted mt-2">
        Data is synthetic and aggregated by zone. This prototype does not show exact addresses or identifiable locations.
      </div>
    </div>
  </div>

  <!-- Summary metrics (hook points for backend later) -->
  <div class="row g-3 mb-3">
    <div class="col-md-4">
      <div class="card app-card h-100">
        <div class="card-body">
          <div class="muted small">Average noise (dB)</div>
          <div class="h2 fw-bold mb-0" id="avgDb">62</div>
          <div class="small text-muted">Selected window</div>
        </div>
      </div>
    </div>
    <div class="col-md-4">
      <div class="card app-card h-100">
        <div class="card-body">
          <div class="muted small">Peak time</div>
          <div class="h2 fw-bold mb-0" id="peakTime">18:00–20:00</div>
          <div class="small text-muted">Highest average</div>
        </div>
      </div>
    </div>
    <div class="col-md-4">
      <div class="card app-card h-100">
        <div class="card-body">
          <div class="muted small">Reports in window</div>
          <div class="h2 fw-bold mb-0" id="reportCount">38</div>
          <div class="small text-muted">All categories</div>
        </div>
      </div>
    </div>
  </div>

  <div class="card app-card mb-3">
    <div class="card-body">
      <div class="d-flex justify-content-between align-items-start mb-2">
        <div>
          <div class="h6 mb-1">Noise map view (schematic)</div>
          <div class="muted small">Zone-level average dB for selected filters</div>
        </div>
        <span class="badge text-bg-light">Live data</span>
      </div>
      <div id="zoneMap" class="zone-map-grid">
        <div class="muted small">Loading map data…</div>
      </div>
    </div>
  </div>

  <!-- Chart + table -->
  <div class="row g-3">
    <div class="col-lg-8">
      <div class="card app-card h-100">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-start mb-2">
            <div>
              <div class="h6 mb-1">Noise trend (dB)</div>
              <div class="muted small">Live trend from selected filters</div>
            </div>
            <span class="badge text-bg-light">Live data</span>
          </div>

          <!-- Hook point -->
          <div id="trendChart" class="chart-placeholder">
            <div class="muted small">Chart renders here using API data.</div>
          </div>

        </div>
      </div>
    </div>

    <div class="col-lg-4">
      <div class="card app-card h-100">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-start mb-2">
            <div>
              <div class="h6 mb-1">Recent observations</div>
              <div class="muted small">Showing the 6 most recent records from API</div>
            </div>
            <span class="badge text-bg-light">Live data</span>
          </div>

          

          <!-- Hook point for API data -->
          <div id="noise-data-container"></div>

          <div class="d-grid mt-3">
            <a class="btn btn-outline-secondary btn-pill" href="{{ url_for('report') }}">
              <i class="bi bi-megaphone me-1"></i>Report an incident
            </a>
          </div>
        </div>
      </div>
    </div>
  </div>
</main>

<style>
  .chart-placeholder{
    height: 360px;
    border-radius: 16px;
    border: 1px dashed rgba(15,23,42,0.18);
    background: rgba(255,255,255,0.6);
    display: grid;
    place-items: center;
    padding: 18px;
    text-align: center;
  }
  .zone-map-grid{
    display:grid;
    grid-template-columns: repeat(auto-fill, minmax(130px, 1fr));
    gap:10px;
  }
  .zone-tile{
    border:1px solid rgba(15,23,42,0.12);
    border-radius:12px;
    padding:10px;
  }
</style>
{% endblock %}