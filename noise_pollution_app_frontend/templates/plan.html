<!-- templates/plan.html -->
{% extends "base.html" %}
{% block title %}Plan · Noise Explorer{% endblock %}

{% block content %}
<header class="container py-4 py-lg-5">
  <div class="d-flex flex-wrap justify-content-between align-items-end gap-3">
    <div>
      <div class="d-flex flex-wrap gap-2 mb-2">
        <span class="pill pill-soft"><i class="bi bi-tools me-1"></i>Intervention catalogue</span>
        <span class="pill pill-dark"><i class="bi bi-geo-alt me-1"></i>Zone-level planning</span>
      </div>
      <h1 class="h2 fw-bold mb-1">Mitigation Planner</h1>
      <p class="muted mb-0">Estimate cost, feasibility, and expected noise reduction for a selected intervention.</p>
    </div>

    <button class="btn btn-outline-secondary btn-pill" disabled
            data-bs-toggle="tooltip" data-bs-title="Planned for Sprint 2">
      <i class="bi bi-file-earmark-arrow-down me-1"></i>Export plan
    </button>
  </div>
</header>

<main class="container pb-5">
  <div class="card app-card mb-3">
    <div class="card-body d-flex gap-3 align-items-start">
      <div class="badge-icon bg-soft-slate flex-shrink-0"><i class="bi bi-eye"></i></div>
      <div>
        <div class="h6 mb-1">Transparent impact model</div>
        <div class="muted small">
          Expected impact is a simple range (dB reduction) seeded for demo and refined in Sprint 2.
          This is not an ML prediction.
        </div>
      </div>
    </div>
  </div>

  <div class="row g-3">
    <div class="col-lg-7">
      <div class="card app-card h-100">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-start mb-2">
            <div>
              <div class="h5 mb-1">Create a plan</div>
              <div class="muted small">Single intervention plan.</div>
            </div>
            <span class="badge text-bg-light">Prototype v0.1</span>
          </div>

          <form id="planForm" method="post" action="{{ url_for('plan') }}" novalidate>
            <div class="row g-3 mb-5">
              <div class="col-md-6">

                <label class="form-label fw-semibold" for="zone">Zone *</label>
                <select class="form-select" id="zone" name="zone" required>
                  <option value="" selected disabled>Select a zone</option>
                </select>
                <div class="invalid-feedback">Please select a zone.</div>
              </div>

              <div class="col-md-6">
                <label class="form-label fw-semibold" for="intervention">Intervention *</label>
                <!-- Hook point: backend can render options -->
                <select class="form-select" id="intervention" name="intervention" required style="position: relative; z-index: 1000;">
                  <option value="" selected disabled>Select an intervention</option>
                </select>
                <div class="invalid-feedback">Please select an intervention.</div>
              </div>


              <div class="col-12">
                <label class="form-label fw-semibold" for="notes">Notes (optional)</label>
                <textarea class="form-control" id="notes" name="notes" rows="3"
                          placeholder="Short notes (stakeholders, timeline)."></textarea>
              </div>

              <div class="col-12 d-flex flex-wrap gap-2">
                <button class="btn btn-dark btn-pill" type="submit">
                  <i class="bi bi-plus-circle me-1"></i>Create plan
                </button>
                <button class="btn btn-outline-secondary btn-pill" type="reset">
                  <i class="bi bi-x-circle me-1"></i>Clear
                </button>
              </div>
            </div>
          </form>

          <div id="planConfirmation" class="alert alert-success mt-4 d-none" role="status">
            <i class="bi bi-check-circle-fill me-1"></i>
            Plan created (prototype). Status: <strong>Planned</strong>.
          </div>
        </div>
      </div>
    </div>

    <div class="col-lg-5">
      <div class="card app-card h-100">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-start mb-2">
            <div>
              <div class="h6 mb-1">Intervention details</div>
              <div class="muted small">Auto-updates based on selection (seeded)</div>
            </div>
            <span class="badge text-bg-light">Seeded</span>
          </div>

          <div class="d-grid gap-2">
            <div class="p-3 rounded-4 border bg-white">
              <div class="muted small">Cost band</div>
              <div class="h5 mb-0" id="costBand">—</div>
            </div>
            <div class="p-3 rounded-4 border bg-white">
              <div class="muted small">Feasibility score</div>
              <div class="h5 mb-0" id="feasibility">—</div>
            </div>
            <div class="p-3 rounded-4 border bg-white">
              <div class="muted small">Expected impact (dB reduction)</div>
              <div class="h5 mb-0" id="impact">—</div>
            </div>
          </div>

          <div class="small text-muted mt-3">
            Values are explainable ranges (not ML predictions) used to guide planning choices.
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="card app-card mt-3">
    <div class="card-body">
      <div class="d-flex justify-content-between align-items-start mb-2">
        <div>
          <div class="h6 mb-1">Created plans</div>
          <div class="muted small">Keep this list short and focused.</div>
        </div>
        <span class="badge text-bg-light">Live data</span>
      </div>

      <div class="table-responsive">
        <table class="table align-middle mb-0">
          <thead class="table-light">
            <tr class="small text-muted">
              <th>Plan ID</th><th>Zone</th><th>Interventions</th><th>Status</th><th>Expected impact</th><th>Notes / Evidence</th><th>Save</th>
            </tr>
          </thead>

          <!-- Hook point -->
          <tbody id="plansTable">
            <tr>
              <td colspan="7" class="text-muted small">Loading plans…</td>
            </tr>
          </tbody>
        </table>
      </div>

      <div class="small text-muted mt-3">
        Update status and notes to track implementation evidence.
      </div>
    </div>
  </div>
</main>
{% endblock %}
